{% extends 'scheduling/base.html' %}
{% load static %}
{% block styles %}
    <link rel="stylesheet" href="{% static 'dashboard/css/admin.css' %}" />
{% endblock %}
{% block content %}
<section>
    <div class="header-actions">
        <div>
            <h2>Financeiro</h2>
            <p><a href="{% url 'logout' %}" class="btn-logout">Sair</a></p>
        </div>
        <button id="download-report" class="btn-primary">
            <i data-lucide="download"></i> Baixar Relatório
        </button>
    </div>
    <div class="grid">
        <div class="card">
            <h3>Total virtual (PIX)</h3>
            <p>R${{ total_virtual }}</p>
        </div>
        <div class="card">
            <h3>Total físico (dinheiro)</h3>
            <p>R${{ total_fisico }}</p>
        </div>
    </div>
    <div class="charts-grid" id="charts-area">
        <div class="chart-card">
            <h3>Totais por método</h3>
            <div class="chart-container">
                <canvas id="chart-methods"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <h3>Receita por dia</h3>
            <div class="chart-container">
                <canvas id="chart-daily"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <h3>Receita por mês</h3>
            <div class="chart-container">
                <canvas id="chart-monthly"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <h3>Top serviços por receita</h3>
            <div class="chart-container">
                <canvas id="chart-services"></canvas>
            </div>
        </div>
        <div class="chart-card">
            <h3>Ticket médio</h3>
            <div class="chart-container">
                <canvas id="chart-ticket"></canvas>
            </div>
        </div>
    </div>
    <div class="table-responsive" style="margin-top:16px">
    <table class="table">
        <thead>
            <tr>
                <th>Data</th><th>Cliente</th><th>Serviço</th><th>Barbeiro</th><th>Valor</th><th>Forma de pagamento</th>
            </tr>
        </thead>
        <tbody>
            {% for ap in pagos %}
            <tr>
                <td>{{ ap.date|date:'d/m/Y' }} {{ ap.hour|time:'H:i' }}</td>
                <td>{{ ap.client_name }}</td>
                <td>{{ ap.service_label }}</td>
                <td>{{ ap.barber }}</td>
                <td>R${% if ap.service == 'combo' %}100{% else %}50{% endif %}</td>
                <td>{{ ap.get_payment_method_display }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="6">Nenhum pagamento concluído</td></tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {{ finance_init|json_script:"finance-init-data" }}
    <script src="{% static 'dashboard/js/admin.js' %}"></script>
    <script src="{% static 'dashboard/js/finance_charts.js' %}"></script>
</section>
{% endblock %}
